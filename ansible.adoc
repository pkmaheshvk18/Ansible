============================================================
                   ANSIBLE COMPLETE GUIDE
============================================================

1) WHAT IS ANSIBLE?
-------------------
Ansible is an open-source IT automation tool used for:

- Configuration management (install packages, update configs, etc.)
- Provisioning infrastructure (create servers on AWS, Azure, etc.)
- Application deployment (deploy apps easily to multiple servers)
- Orchestration (manage multiple servers/tasks in sequence)

Key Features:
- Agentless: No agent needed on targets; uses SSH (Linux) & WinRM (Windows)
- Declarative: Describe desired state; Ansible figures out how

------------------------------------------------------------

2) WHY USE ANSIBLE?
-------------------
Simple: Written in YAML, easy to understand
Idempotent: Tasks not repeated if already done
Cross-platform: Linux, Windows, Cloud, Containers
DevOps-friendly: Works with CI/CD (Jenkins, GitLab CI)
Scalable: Manage 10 or 10,000 servers with same playbook

------------------------------------------------------------

3) HOW DOES ANSIBLE WORK?
-------------------------
- Control Node: Machine with Ansible installed
- Managed Nodes: Servers you configure via SSH/WinRM
- Inventory File: List of servers (IPs/hostnames)
- Modules: Pre-built functionality (install packages, copy files)
- Playbooks: YAML files describing tasks

Flow:
Ansible connects via SSH --> Executes tasks --> Reports results

------------------------------------------------------------

4) WHERE CAN YOU USE ANSIBLE? (REAL-WORLD USE CASES)
----------------------------------------------------
- Provision AWS EC2, RDS, S3
- Deploy Docker/Kubernetes
- Install & configure Nginx/Apache
- Patch 100+ servers automatically
- CI/CD pipelines (auto-deploy on code push)
- Security hardening (firewall, users, SSH keys)

============================================================
              HANDS-ON: STEP-BY-STEP SETUP
============================================================

Servers:
- Control Node: Your machine (Ansible installed here)
- Target Node: Server to execute tasks
* Only install Ansible on control node, not on target node.

------------------------------------------------------------
Step 1: Install Ansible on Control Node
------------------------------------------------------------
For Ubuntu/Debian:
  sudo apt update && sudo apt install ansible -y

For CentOS/RHEL:
  sudo yum install epel-release -y
  sudo yum install ansible -y

Verify:
  ansible --version

------------------------------------------------------------
Step 2: Generate SSH Key (On Control Node)
------------------------------------------------------------
Goal: Passwordless SSH login to target node.

On control node:
  ssh-keygen    # press Enter 3 times (default path, no passphrase)

Creates:
  Private key: ~/.ssh/id_rsa
  Public key : ~/.ssh/id_rsa.pub

------------------------------------------------------------
Step 3: Copy SSH Key to Target Server
------------------------------------------------------------
Copy public key for passwordless login:
  ssh-copy-id user@TARGET_SERVER_IP

If ssh-copy-id not available:
  ssh user@TARGET_SERVER_IP "mkdir -p ~/.ssh && cat >> ~/.ssh/authorized_keys" < ~/.ssh/id_rsa.pub

Test login:
  ssh user@TARGET_SERVER_IP   # should log in without password

Clarification:
- SSH key generated on control node.
- Public key copied to target node.
- No need to create key on target.

------------------------------------------------------------
Step 4: Create Inventory File (On Control Node)
------------------------------------------------------------
Inventory defines which servers Ansible manages.

Create /etc/ansible/hosts (or custom path):

  [web]
  TARGET_SERVER_IP ansible_user=ubuntu ansible_ssh_private_key_file=~/.ssh/id_rsa

Notes:
- [web] = group name
- Replace ubuntu with target node username
- Replace TARGET_SERVER_IP with actual IP

Check connection:
  ansible -i /etc/ansible/hosts web -m ping
Should return:  {"ping": "pong"}

Clarification:
- Inventory file always on control node.
- Target servers are just listed in inventory.

------------------------------------------------------------
Step 5: First Simple Playbook
------------------------------------------------------------
Create install_nginx.yml on control node:

  - hosts: web
    become: true
    tasks:
      - name: Install Nginx
        apt:
          name: nginx
          state: present
      - name: Start Nginx
        service:
          name: nginx
          state: started
      - name: Deploy custom index.html
        copy:
          content: "<h1>Hello from Ansible!</h1>"
          dest: /var/www/html/index.html

Run the playbook:
  ansible-playbook -i /etc/ansible/hosts install_nginx.yml

Verify:
  curl http://TARGET_SERVER_IP
Should display: Hello from Ansible!

------------------------------------------------------------
Real-World Scenario:
------------------------------------------------------------
Imagine 50 servers:
- Install Nginx on all
- Deploy app
Instead of SSH into each, run one playbook; Ansible does all.

============================================================
            DETAILED COMMAND EXPLANATIONS
============================================================

1) Copy SSH Key Command:
------------------------
ssh user@TARGET_SERVER_IP "mkdir -p ~/.ssh && cat >> ~/.ssh/authorized_keys" < ~/.ssh/id_rsa.pub

Breakdown:
- ssh user@TARGET_SERVER_IP: Connects control node to target
  user = target username (ubuntu, ec2-user, root, etc.)
  TARGET_SERVER_IP = IP of target server

- "mkdir -p ~/.ssh && cat >> ~/.ssh/authorized_keys":
  mkdir -p ~/.ssh: Create .ssh dir if not exists
  &&: Run next command if previous succeeds
  cat >> ~/.ssh/authorized_keys: Append incoming public key

- < ~/.ssh/id_rsa.pub:
  Reads your local public key and sends as input to remote cat

Result:
Now private key (~/.ssh/id_rsa) matches public key on target for passwordless SSH.

------------------------
2) Inventory File Entry:
------------------------
[web]
TARGET_SERVER_IP ansible_user=ubuntu ansible_ssh_private_key_file=~/.ssh/id_rsa

Breakdown:
- [web]: Group name; use hosts: web in playbooks
- TARGET_SERVER_IP: IP or DNS of target server
- ansible_user=ubuntu: SSH user Ansible should use
- ansible_ssh_private_key_file=~/.ssh/id_rsa: Private key path for authentication

------------------------
3) Ansible Ping Command:
------------------------
ansible -i /etc/ansible/hosts web -m ping

Breakdown:
- ansible: CLI tool
- -i /etc/ansible/hosts: Inventory file path
- web: Group name from inventory
- -m ping: Use ping module to check:
  - SSH connectivity
  - Python availability on target
  - Ansible can execute tasks

Result:
  {"ping": "pong"} confirms setup success.

============================================================
Summary Flow:
------------------------------------------------------------
1. Copy SSH key to target => Enables passwordless login
2. Define inventory file  => Tells Ansible target details
3. Run ansible -m ping    => Validates connection & config

============================================================
